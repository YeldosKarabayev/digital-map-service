{"ast":null,"code":"import{useState,useEffect,useContext,useRef}from'react';import{useNavigate,Link}from'react-router-dom';import ClipLoader from'react-spinners/ClipLoader';import{useDispatch}from'react-redux';import{setCredentials}from'./authSlice';import{useLoginMutation}from'./authApiSlice';import usePersist from'../../hooks/usePersist';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const Auth=()=>{const userRef=useRef();const errRef=useRef();const[username,setUsername]=useState('');const[password,setPassword]=useState('');const[showPassword,setShowPassword]=useState(false);const[errMsg,setErrMsg]=useState('');const[persist,setPersist]=usePersist();const navigate=useNavigate();const dispatch=useDispatch();const[login,{isLoading}]=useLoginMutation();//let [loading, setLoaging] = useState(true);\n// useEffect(() => {\n//   userRef.current.focus()\n// }, [])\nuseEffect(()=>{setErrMsg('');},[username,password]);const handleSubmit=async e=>{e.preventDefault();try{const{accessToken}=await login({username,password});dispatch(setCredentials({accessToken}));setUsername('');setPassword('');navigate('/dash');}catch(err){if(err.status){setErrMsg(\"Нет ответа от сервера!\");}else if(err.status===400){setErrMsg(\"Неправильный Имя или Пароль!\");}else if(err.status===401){setErrMsg(\"Не удалось авторизоваться!\");}else{var _err$data;setErrMsg((_err$data=err.data)===null||_err$data===void 0?void 0:_err$data.message);}// errRef.current.focus();\n}};const handleUserInput=e=>setUsername(e.target.value);const handlePwdInput=e=>setPassword(e.target.value);const handleToggle=()=>setPersist(prev=>!prev);const errClass=errMsg?\"errmsg\":\"offscreen\";if(isLoading)return;//<p>Загрузка...</p>\n/*#__PURE__*/_jsx(ClipLoader,{loading:isLoading,size:150,\"aria-label\":\"Loading Spinner\",\"data-testid\":\"loader\"});return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"div\",{className:\"full\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"signupScreen\",children:[/*#__PURE__*/_jsx(\"p\",{ref:errRef,className:errClass,\"aria-live\":\"assertive\",children:errMsg}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"username\",className:\"title\",children:\"\\u0410\\u0432\\u0442\\u043E\\u0440\\u0438\\u0437\\u0430\\u0446\\u0438\\u044F\"}),/*#__PURE__*/_jsx(\"input\",{className:\"inputs\",id:\"username\",type:\"text\",placeholder:\"\\u041B\\u043E\\u0433\\u0438\\u043D\",ref:userRef,value:username,onChange:handleUserInput,autoComplete:\"off\",required:true}),/*#__PURE__*/_jsx(\"input\",{className:\"inputs\",type:showPassword?'text':'password',placeholder:\"\\u041F\\u0430\\u0440\\u043E\\u043B\\u044C\",id:\"password\",onChange:handlePwdInput,value:password,required:true}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setShowPassword(!showPassword),children:showPassword?'Скрыть пароль':'Показать пароль'}),/*#__PURE__*/_jsx(\"button\",{children:\"\\u0412\\u043E\\u0439\\u0442\\u0438\"}),/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"persist\",className:\"form__persist\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",className:\"form__checkbox\",id:\"presist\",onChange:handleToggle,checked:persist}),\"\\u0414\\u043E\\u0432\\u0435\\u0440\\u044F\\u044E \\u0441\\u0442\\u0440\\u0430\\u043D\\u0438\\u0446\\u0435\"]})]})]})})});};export default Auth;","map":{"version":3,"names":["useState","useEffect","useContext","useRef","useNavigate","Link","ClipLoader","useDispatch","setCredentials","useLoginMutation","usePersist","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Auth","userRef","errRef","username","setUsername","password","setPassword","showPassword","setShowPassword","errMsg","setErrMsg","persist","setPersist","navigate","dispatch","login","isLoading","handleSubmit","e","preventDefault","accessToken","err","status","_err$data","data","message","handleUserInput","target","value","handlePwdInput","handleToggle","prev","errClass","loading","size","children","className","ref","onSubmit","htmlFor","id","type","placeholder","onChange","autoComplete","required","onClick","checked"],"sources":["C:/Users/MSI/Desktop/final-map-app/client/client/src/features/auth/Auth.jsx"],"sourcesContent":["import { useState, useEffect, useContext, useRef } from 'react';\r\nimport { useNavigate, Link } from 'react-router-dom';\r\nimport ClipLoader from 'react-spinners/ClipLoader'\r\nimport { useDispatch } from 'react-redux';\r\nimport { setCredentials } from './authSlice';\r\nimport { useLoginMutation } from './authApiSlice';\r\n\r\nimport usePersist from '../../hooks/usePersist';\r\n\r\n\r\nconst Auth = () => {\r\n  const userRef = useRef()\r\n  const errRef = useRef()\r\n\r\n  const [username, setUsername] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [errMsg, setErrMsg] = useState('');\r\n  const [persist, setPersist] = usePersist()\r\n\r\n  const navigate = useNavigate();\r\n  const dispatch = useDispatch()\r\n\r\n  const [login, { isLoading}] = useLoginMutation()\r\n\r\n  //let [loading, setLoaging] = useState(true);\r\n\r\n  // useEffect(() => {\r\n  //   userRef.current.focus()\r\n  // }, [])\r\n\r\n  useEffect(() => {\r\n    setErrMsg('');\r\n  }, [username, password])\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault()\r\n    try {\r\n      const { accessToken } = await login({ username, password })\r\n      dispatch(setCredentials({ accessToken }))\r\n      setUsername('')\r\n      setPassword('')\r\n      navigate('/dash')\r\n    } catch(err) {\r\n      if(err.status) {\r\n        setErrMsg(\"Нет ответа от сервера!\");\r\n      } else if (err.status === 400) {\r\n        setErrMsg(\"Неправильный Имя или Пароль!\");\r\n      } else if (err.status === 401) {\r\n        setErrMsg(\"Не удалось авторизоваться!\");\r\n      } else {\r\n        setErrMsg(err.data?.message);\r\n      }\r\n      // errRef.current.focus();\r\n    }\r\n  }\r\n\r\n  const handleUserInput = (e) => setUsername(e.target.value)\r\n  const handlePwdInput = (e) => setPassword(e.target.value)\r\n  const handleToggle = () => setPersist(prev => !prev)\r\n\r\n  const errClass = errMsg ? \"errmsg\" : \"offscreen\"\r\n\r\n  if(isLoading) return \r\n    //<p>Загрузка...</p>\r\n    <ClipLoader \r\n      loading={isLoading}\r\n      size={150}\r\n      aria-label='Loading Spinner'\r\n      data-testid=\"loader\"  \r\n    />\r\n\r\n  \r\n\r\n  return (\r\n    <>\r\n    <div className='full'>\r\n    <div className='signupScreen'>\r\n      <p ref={errRef} className={errClass} aria-live='assertive'>{errMsg}</p>\r\n        <form onSubmit={handleSubmit}>\r\n          <label htmlFor='username' className='title'>Авторизация</label>\r\n          <input \r\n                className='inputs'\r\n                id=\"username\"\r\n                type=\"text\"\r\n                placeholder='Логин'\r\n                ref={userRef}\r\n                value={username}\r\n                onChange={handleUserInput}\r\n                autoComplete='off'\r\n                required\r\n           />\r\n          <input className='inputs'\r\n                type={showPassword ? 'text' : 'password'}\r\n                placeholder='Пароль'\r\n                id='password'\r\n                onChange={handlePwdInput}\r\n                value={password}\r\n                required\r\n          />\r\n          <button type=\"button\" onClick={() => setShowPassword(!showPassword)}>\r\n              {/* Кнопка для скрытия/отображения пароля */}\r\n              {showPassword ? 'Скрыть пароль' : 'Показать пароль'}\r\n          </button>\r\n          <button>Войти</button>\r\n          <label htmlFor='persist' className='form__persist'>\r\n            <input\r\n              type='checkbox'\r\n              className='form__checkbox'\r\n              id='presist'\r\n              onChange={handleToggle}\r\n              checked={persist}\r\n            />\r\n            Доверяю странице\r\n          </label>\r\n        </form>\r\n        {/* {error && <p>{error}</p>} */}\r\n    </div>\r\n    </div>\r\n    </>\r\n  )\r\n}\r\n\r\nexport default Auth"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}